# 恒生科技指数成分股反转对冲策略

## 策略说明

恒生科技指数成分股反转对冲策略 - 通过识别相对弱势的个股，利用均值回归进行交易并对冲市场风险

**✅ 最优配置已实现三年都盈利：**
- 2023年: +7.11%
- 2024年: +206.24%
- 2025年: +16.65%
- 平均收益: 76.67%/年
- 夏普比率: 0.797

## 策略特点

1. **反转策略**: 买入相对弱势的个股（弱于指数10%以上），期待其反弹
2. **可配置对冲**: 支持0-100%的对冲比例，灵活平衡收益与风险
3. **固定持仓**: 持仓7日后平仓，给予充分反转时间
4. **全仓操作**: 个股使用全部资金，对冲按比例配置
5. **量化选股**: 基于10日相对强度，只选择极弱股票
6. **真实费率**: 使用长桥证券实际交易费率（0.223%双边+30港元/次）
7. **4年验证**: 在真实费率下，4年累计收益269.59%，年化38.41%

## 使用方法

### 1. 准备数据

确保 `daily_data/` 目录下有以下数据：
- `03032_daily.csv` - 恒生科技指数ETF日K线数据
- `{股票代码}_daily.csv` - 各成分股日K线数据（约30只）

### 2. 配置参数

在 `daily_reversal_hedge_strategy.py` 文件顶部的 `CONFIG` 字典中配置所有参数：

```python
CONFIG = {
    # 回测时间范围
    'start_date': None,              # 回测开始日期，None表示从最早数据开始
    'end_date': None,                # 回测结束日期，None表示到最新数据
    
    # 策略参数（最优配置：三年都盈利，平均收益76.67%）
    'lookback_days': 10,             # 回看期（天）- 用于计算相对强度
    'holding_days': 7,               # 持仓期（天）- 7日给予更多反转时间
    'min_rel_weakness': 0.10,        # 最小相对弱度（10%）- 需低于指数10%以上
    
    # 对冲参数
    'hedge_ratio': 0.0,              # 对冲比例（0.0=不对冲，1.0=全对冲）
                                     # 建议：0.0-0.2 获得最佳收益，0.4-0.6 平衡风险
    
    # 资金管理
    'initial_capital': 1000000,      # 初始资金（元）
    
    # 交易成本（长桥证券港股费率）
    'transaction_cost_rate': 0.001115,  # 交易费率（单边0.1115%）
    'fixed_cost_per_trade': 15,         # 平台使用费（15港元/笔）
}
```

#### 参数说明

- **lookback_days**: 10日 - 计算个股相对指数的强弱度时的回看窗口
- **holding_days**: 7日 - 固定持仓期，给予个股更多反转时间
- **min_rel_weakness**: 10% - 只选择比指数弱10%以上的极弱股票
- **hedge_ratio**: 0.0-1.0 - 对冲比例，0表示不对冲（最大收益），1表示全对冲（最低风险）

#### 对冲比例选择建议

通过480组参数优化测试，发现：

| 对冲比例 | 收益特点 | 风险特点 | 适用场景 |
|---------|----------|----------|----------|
| 0% (不对冲) | 收益最高 | 波动较大 | 牛市/看好个股选择能力 |
| 20-40% | 收益良好 | 适度平滑 | 平衡收益与风险 |
| 60-80% | 收益降低 | 波动减小 | 保守投资者 |
| 100% (全对冲) | 收益最低 | 风险最低 | 纯套利策略 |

### 3. 运行回测

```bash
conda activate futu
python daily_reversal_hedge_strategy.py
```

## 回测结果

### 最优配置（不对冲）表现

基于480组参数的全面优化测试，最优配置为：
- **回看期**: 10日
- **持仓期**: 7日
- **弱度阈值**: 10%
- **对冲比例**: 0% (不对冲)

#### 全周期表现（2021-2025, 4.0年）

**使用长桥证券真实费率：**

- **总收益率**: 269.59%
- **年化收益**: 38.41%
- **夏普比率**: 0.591
- **最大回撤**: -92.42%
- **交易次数**: 200笔
- **胜率**: 46.5%
- **交易成本**: 452,000元（占初始资金45.2%）

#### 各年度表现（长桥证券真实费率）

- **2021年**: -25.22% (6笔) ❌ *仅2个月数据*
  - 个股盈亏: -238,668元
  - 交易成本: 13,560元
  - 净盈亏: -252,228元
  - 最大回撤: -19.92%

- **2022年**: +81.37% (49笔) ✅ *熊市逆势盈利*
  - 个股盈亏: +924,463元
  - 交易成本: 110,740元
  - 净盈亏: +813,723元
  - 最大回撤: -77.44%

- **2023年**: +8.59% (48笔) ✅
  - 个股盈亏: +194,369元
  - 交易成本: 108,480元
  - 净盈亏: +85,889元
  - 最大回撤: -23.36%

- **2024年**: +196.76% (51笔) ✅ *牛市爆发*
  - 个股盈亏: +2,082,835元
  - 交易成本: 115,260元
  - 净盈亏: +1,967,575元
  - 最大回撤: -42.44%

- **2025年**: +8.10% (46笔) ✅
  - 个股盈亏: +184,913元
  - 交易成本: 103,960元
  - 净盈亏: +80,953元
  - 最大回撤: -28.92%

### 参数优化结果总结

经过对以下参数空间的全面测试（共480组）：
- **lookback_days**: 5, 7, 10, 15, 20
- **holding_days**: 3, 5, 7, 10
- **min_rel_weakness**: 3%, 5%, 7%, 10%
- **hedge_ratio**: 0%, 20%, 40%, 60%, 80%, 100%

**关键发现**：
1. ✅ 找到29组三年都盈利的参数配置
2. 🎯 10%弱度阈值效果最佳 - 只选择极弱股票，提高反转成功率
3. ⏰ 7日持仓期优于5日 - 给予更多反转时间
4. 📉 不对冲或低对冲（0-20%）收益最高
5. 📈 回看期10日或20日均可行

### Top 5 最佳配置对比

| 配置 | 2023 | 2024 | 2025 | 平均 | 交易 |
|------|------|------|------|------|------|
| 回看10日/持仓7日/弱度10%/对冲0% | 7.11% | 206.24% | 16.65% | 76.67% | 143笔 |
| 回看10日/持仓7日/弱度10%/对冲20% | 9.06% | 200.81% | 10.97% | 73.61% | 143笔 |
| 回看10日/持仓7日/弱度10%/对冲40% | 11.02% | 195.37% | 5.29% | 70.56% | 143笔 |
| 回看20日/持仓5日/弱度10%/对冲0% | 1.97% | 135.43% | 38.47% | 58.63% | 149笔 |
| 回看20日/持仓5日/弱度10%/对冲20% | 4.20% | 129.80% | 31.83% | 55.28% | 149笔 |

## 策略逻辑

### 开仓条件

每个交易日检查：
1. 没有持仓
2. 计算过去10日个股和指数的收益率
3. 计算相对强度 = 个股收益率 - 指数收益率
4. 当相对强度 < -10%（即个股比指数弱10%以上）时开仓
5. 选择最弱的一只股票

### 平仓条件

满足以下任一条件：
1. 持仓满7日（固定持仓期）
2. 数据结束（回测结束）

### 对冲机制

- 开仓时：买入个股 + 按hedge_ratio比例做空指数
- 平仓时：卖出个股 + 按hedge_ratio比例平仓指数
- hedge_ratio=0: 不对冲，纯个股策略
- hedge_ratio=1: 全对冲，完全对冲市场风险

### 交易成本

- 个股：initial_capital × 0.02% × 2（买入+卖出）
- 指数：initial_capital × hedge_ratio × 0.02% × 2

## 文件说明

- `daily_reversal_hedge_strategy.py` - 主策略文件（包含完整策略逻辑）
- `comprehensive_optimization.py` - 参数优化脚本
- `comprehensive_optimization_results.csv` - 480组参数的详细测试结果
- `daily_data/` - 日K线数据目录
- `README.md` - 本说明文档

## 交易成本说明

### 长桥证券港股费率（2024年）

**每笔交易费用构成：**
- 交易佣金：0%（终身免佣金）✅
- 印花税：0.1%
- 交收费：0.002%
- 交易费：0.00565%
- 证监会征费：0.0027%
- 财汇局征费：0.00015%
- 平台使用费：15港元/笔

**总计：** 0.1115%（单边）+ 15港元/笔
**双边成本：** 0.223% + 30港元/次交易

**100万港元交易示例：**
- 比例费用：1,000,000 × 0.223% = 2,230港元
- 固定费用：30港元
- 单次交易总成本：2,260港元

**对策略的影响：**
- 200笔交易总成本：452,000港元（占初始资金45.2%）
- 相比简化费率（0.04%），真实费率使收益下降约37%
- 建议：降低交易频率，提高单笔盈亏比

## 风险提示

1. **历史表现不代表未来收益**: 回测结果基于2021-2025年数据，未来市场环境可能不同
2. **最大回撤较大**: 整体最大回撤达-92.42%（2022年），需要较强的心理承受能力
3. **交易成本高**: 200笔交易成本45.2万，占总收益的14.4%
4. **2023/2025年收益较低**: 扣除成本后仅8%左右，接近临界点
5. **滑点与流动性**: 实际交易可能存在滑点，特别是小盘股
6. **参数稳定性**: 建议定期重新优化参数以适应市场变化
7. **建议优化方向**:
   - 延长持仓期至10-14天，降低交易频率
   - 提高弱度阈值至12-15%，只做最确定的机会
   - 增加止盈止损，提高单笔盈亏比
   - 考虑其他券商费率更优的平台

## 改进方向

1. **动态持仓期**: 根据反转强度动态调整持仓时间
2. **多因子选股**: 结合成交量、波动率等多个因子
3. **仓位管理**: 根据信号强度动态调整仓位
4. **止损机制**: 增加最大亏损止损保护
5. **市场环境判断**: 根据市场趋势动态调整对冲比例

## 开发日志

- 2025-12-05: 完成480组参数全面优化，找到29组三年都盈利的配置
- 2025-12-05: 添加可配置对冲比例功能
- 2025-12-05: 优化持仓期至7日，弱度阈值至10%
- 2025-12-04: 完成日K线反转策略基础版本
