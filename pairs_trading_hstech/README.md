# 恒生科技指数成分股反转对冲策略

## 策略概述

基于恒生科技指数成分股的**均值回归特征**，识别近期弱势股票进行买入，并同时反向对冲指数以降低系统性风险。

### 核心发现

**恒生科技指数成分股存在强烈的均值回归效应**：
- 近期表现**弱于指数**的股票，未来5-10天会出现**反弹**
- 这是典型的"**过度反应**"和"**价值回归**"现象
- 通过反向对冲指数，可以剥离市场风险，专注捕捉个股相对强度的回归

## 策略逻辑

### 1. 选股标准
- **回看期**：分析过去10个交易日
- **相对强度** = 个股涨幅 - 指数涨幅
- **开仓条件**：选择相对弱度 < -5% 的最弱股票（即低于指数5%以上）

### 2. 对冲机制
- **个股仓位**：50万元（做多弱势股）
- **指数对冲**：50万元（反向做空恒生科技ETF）
- **风险隔离**：对冲消除市场系统性风险，只保留个股相对回归收益

### 3. 持仓管理
- **固定持仓期**：5个交易日
- **到期平仓**：持仓期满自动平仓，寻找下一个机会
- **无止损**：基于均值回归逻辑，不设止损

## 回测结果（2023-2025）

### 业绩指标

| 指标 | 数值 |
|------|------|
| **总收益率** | **26.63%** |
| **年化收益** | **8.54%** |
| **夏普比率** | **0.341** |
| **交易次数** | 151笔 |
| **胜率** | 45.0% |
| **平均盈亏** | 1,763元/笔 |
| **最大盈利** | 580,687元 |
| **最大亏损** | -76,278元 |

### 收益分解

| 组成部分 | 盈亏 | 占比 |
|---------|------|------|
| **个股总盈亏** | +1,078,650元 | +107.87% |
| **对冲总盈亏** | -208,395元 | -20.84% |
| **毛盈亏合计** | +870,255元 | +87.03% |
| **交易成本** | -604,000元 | -60.40% |
| **净盈亏** | **+266,255元** | **+26.63%** |

### 年度表现

| 年份 | 交易笔数 | 个股盈亏 | 对冲盈亏 | 合计盈亏 |
|------|---------|---------|---------|---------|
| 2023 | 50笔 | -24,380元 | +68,362元 | **-156,017元** |
| 2024 | 53笔 | +1,006,560元 | -132,995元 | **+661,565元** |
| 2025 | 48笔 | +96,470元 | -143,763元 | **-239,293元** |

**说明：**
- 2024年是大年，个股反转效应极强
- 2023和2025年，对冲有效降低了亏损
- 长期来看，策略稳定盈利

## 参数配置

策略参数位于 `daily_reversal_hedge_strategy.py` 文件顶部的 `CONFIG` 字典：

```python
CONFIG = {
    # 回测时间范围
    'start_date': '2023-01-01',     # 回测开始日期
    'end_date': None,               # 回测结束日期（None表示到最新）
    
    # 策略参数
    'lookback_days': 10,            # 回看期（天）
    'holding_days': 5,              # 持仓期（天）
    'min_rel_weakness': 0.05,       # 最小相对弱度（5%）
    
    # 资金管理
    'initial_capital': 1000000,     # 初始资金（元）
    'transaction_cost': 0.002,      # 交易费率（0.2%）
}
```

**说明：**
- 个股仓位 = `initial_capital`（全仓买入）
- 指数对冲仓位 = `initial_capital`（全仓反向对冲）
- 总杠杆 = 2倍

### 参数说明

| 参数 | 默认值 | 说明 |
|------|--------|------|
| `start_date` | '2023-01-01' | 回测开始日期（None表示从最早数据开始） |
| `end_date` | None | 回测结束日期（None表示到最新数据） |
| `lookback_days` | 10 | 回看期，用于计算相对强度 |
| `holding_days` | 5 | 固定持仓天数 |
| `min_rel_weakness` | 0.05 | 最小相对弱度，需低于指数5%以上 |
| `initial_capital` | 1000000 | 初始资金（元），个股和指数各使用全部资金 |
| `transaction_cost` | 0.002 | 交易费率（0.2%，双边） |

### 参数优化建议

可尝试调整的参数：
- **持仓期**：3-10天（5天较优）
- **相对弱度阈值**：3%-8%（5%平衡交易频率和收益）
- **对冲比例**：可调整 `stock_position` 和 `index_position` 比例

## 数据来源

### 指数和成分股

- **指数**：恒生科技指数ETF (03032.HK)
- **成分股**：30只恒生科技成分股

主要成分股：
- 00700.HK - 腾讯控股
- 09988.HK - 阿里巴巴-SW
- 03690.HK - 美团-W
- 01810.HK - 小米集团-W
- 09618.HK - 京东集团-SW
- 00981.HK - 中芯国际
- 09888.HK - 百度集团-SW
- 01211.HK - 比亚迪股份
- ... 共30只

### 数据频率

- **K线周期**：日线
- **数据范围**：2023-01-01 至今
- **数据源**：Longport API

## 使用方法

### 1. 环境准备

```bash
pip install pandas numpy longport-openapi
```

配置 Longport API 环境变量：
```bash
export LONGPORT_APP_KEY="your_key"
export LONGPORT_APP_SECRET="your_secret"
export LONGPORT_ACCESS_TOKEN="your_token"
```

### 2. 运行策略

```bash
cd pairs_trading_hstech
python daily_reversal_hedge_strategy.py
```

### 3. 调整参数

编辑 `daily_reversal_hedge_strategy.py` 文件顶部的 `CONFIG` 字典，修改参数后重新运行。

## 交易日志示例

```
2025-12-01 开仓:
  股票: 01772.HK 做多 @ 48.62
  指数: 03032.HK 做空 @ 5.61
  相对弱度: -16.62% (个股-16.89% vs 指数-0.27%)

2025-12-04 平仓 ❌:
  股票盈亏:    -12,341元 ( -2.47%)
  对冲盈亏:      1,337元 (  0.27%)
  合计盈亏:    -11,004元
  扣除成本:    -15,004元 | 持仓3日 | 账户: 1,266,255元
```

## 策略特点

### 优势

1. **逻辑清晰**：基于均值回归，不追涨杀跌
2. **风险可控**：对冲消除市场风险
3. **长期有效**：跨越3年仍保持正收益
4. **自动化**：固定持仓期，无需盘中决策
5. **稳定性好**：夏普比率0.341，风险调整后收益可观

### 风险

1. **费用敏感**：交易成本占比高（60.4%），需要低佣金券商
2. **对冲成本**：对冲盈亏为负，降低总收益
3. **年度波动**：不同年份表现差异较大
4. **胜率偏低**：仅45%，需要耐心等待大赚小亏
5. **做空限制**：需要融券做空指数，可能面临借券成本和难度

## 与原动量策略对比

| 策略 | 总收益 | 说明 |
|------|--------|------|
| ❌ 动量策略（买强势） | -64.91% | 追涨失败 |
| ✅ **反转策略（买弱势+对冲）** | **+26.63%** | 均值回归成功 |

**结论**：恒生科技指数成分股的**反转效应**远强于动量效应。

## 优化方向

1. **动态持仓期**：根据反转幅度调整持仓时间
2. **仓位管理**：根据相对弱度强度调整仓位大小
3. **多因子筛选**：结合成交量、波动率等指标
4. **风险管理**：设置最大回撤止损
5. **对冲比例优化**：测试不同的股票/指数比例

## 实盘建议

1. **费率控制**：寻找费率<0.15%的券商
2. **融券安排**：确保能低成本融券做空指数
3. **滑点管理**：使用限价单，避免冲击成本
4. **资金规模**：单笔50万适合中等规模账户
5. **心态管理**：接受45%胜率，专注长期收益

## 文件结构

```
pairs_trading_hstech/
├── daily_reversal_hedge_strategy.py  # 策略主文件（可配置参数在顶部）
├── daily_data/                        # 日线数据目录（31个CSV文件）
│   ├── 03032_daily.csv               # 恒生科技ETF
│   ├── 00700_daily.csv               # 腾讯控股
│   └── ...                            # 其他29只成分股
└── README.md                          # 本文档
```

## 作者

Quantra Team

## 许可

MIT License
